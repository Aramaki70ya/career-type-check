<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒ£ãƒªã‚¢ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; background: #f5f5f5; padding: 15px; font-size: 14px; }
        .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #1a365d; margin-bottom: 20px; border-bottom: 3px solid #1a365d; padding-bottom: 10px; font-size: 22px; }
        h2 { color: #1a365d; margin: 20px 0 12px; font-size: 16px; border-left: 4px solid #1a365d; padding-left: 10px; }
        h3 { color: #2d3748; font-size: 14px; margin: 12px 0 8px; }
        
        .step { display: none; }
        .step.active { display: block; }
        
        .step-indicator { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
        .step-badge { padding: 8px 20px; background: #e2e8f0; border-radius: 20px; font-size: 13px; color: #718096; }
        .step-badge.active { background: #1a365d; color: #fff; }
        .step-badge.done { background: #38a169; color: #fff; }
        
        label { display: block; font-weight: bold; color: #2d3748; margin-bottom: 6px; font-size: 13px; }
        textarea, input[type="text"] { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 13px; }
        textarea { min-height: 200px; font-family: monospace; }
        textarea:focus, input:focus { outline: none; border-color: #1a365d; }
        
        .form-group { margin-bottom: 15px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-section { background: #f8fafc; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
        
        .list-input { margin-bottom: 8px; }
        .list-input input { margin-bottom: 5px; }
        .add-btn { background: #e2e8f0; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; color: #4a5568; }
        .add-btn:hover { background: #cbd5e0; }
        .remove-btn { background: #fed7d7; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; color: #c53030; margin-left: 5px; }
        
        .button-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        button { padding: 10px 24px; font-size: 14px; font-weight: bold; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #1a365d; color: #fff; }
        .btn-primary:hover:not(:disabled) { background: #2d3748; }
        .btn-secondary { background: #718096; color: #fff; }
        .btn-secondary:hover:not(:disabled) { background: #4a5568; }
        .btn-success { background: #38a169; color: #fff; }
        .btn-success:hover:not(:disabled) { background: #2f855a; }
        
        .loading { display: none; text-align: center; padding: 20px; }
        .loading.active { display: block; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #1a365d; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .message { padding: 12px; border-radius: 4px; margin: 15px 0; display: none; }
        .message.active { display: block; }
        .error { background: #fed7d7; color: #c53030; }
        .success { background: #c6f6d5; color: #22543d; }
        
        .preview-container { border: 1px solid #e2e8f0; border-radius: 4px; }
        .preview-frame { width: 100%; height: 450px; border: none; }
        
        .tip { background: #fef3c7; border: 1px solid #f59e0b; padding: 10px 12px; border-radius: 4px; font-size: 12px; margin-bottom: 15px; }
        .tip strong { color: #92400e; }
        
        .options { margin: 12px 0; }
        .options label { display: inline-flex; align-items: center; gap: 6px; font-weight: normal; cursor: pointer; }
        .options input[type="checkbox"] { width: 16px; height: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“„ ã‚­ãƒ£ãƒªã‚¢ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="step-indicator">
            <span class="step-badge active" id="badge1">1. ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</span>
            <span class="step-badge" id="badge2">2. å†…å®¹ç·¨é›†</span>
            <span class="step-badge" id="badge3">3. PDFä¿å­˜</span>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
        <div class="step active" id="step1">
            <div class="form-group">
                <label>æ–‡å­—èµ·ã“ã—ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ï¼š</label>
                <textarea id="transcript" placeholder="ãƒ’ã‚¢ãƒªãƒ³ã‚°ã®æ–‡å­—èµ·ã“ã—ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
            </div>
            
            <div class="options">
                <label>
                    <input type="checkbox" id="useGemini" checked>
                    AIã§æ–‡ç« ã‚’èª­ã¿ã‚„ã™ãæ•´ç†
                </label>
                <button class="btn-check" onclick="checkApiKey()" style="margin-left: 10px; padding: 5px 10px; font-size: 11px; background: #718096; color: #fff; border: none; border-radius: 4px; cursor: pointer;">APIè¨­å®šç¢ºèª</button>
                <span id="apiStatus" style="margin-left: 8px; font-size: 11px;"></span>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="analyzeData()">ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ â†’</button>
                <button class="btn-secondary" onclick="loadSample()">ã‚µãƒ³ãƒ—ãƒ«èª­ã¿è¾¼ã¿</button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: å†…å®¹ç·¨é›† -->
        <div class="step" id="step2">
            <div class="tip">
                <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼š</strong> å„é …ç›®ã‚’è‡ªç”±ã«ç·¨é›†ã§ãã¾ã™ã€‚ä¸è¦ãªé …ç›®ã¯ç©ºæ¬„ã«ã—ã¦ãã ã•ã„ã€‚
            </div>
            
            <div class="form-section">
                <h3>åŸºæœ¬æƒ…å ±</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å€™è£œè€…å</label>
                        <input type="text" id="edit_candidateName">
                    </div>
                    <div class="form-group">
                        <label>ä½œæˆæ—¥</label>
                        <input type="text" id="edit_date">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>é€ä»˜ä¸»ï¼ˆã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆåï¼‰</label>
                        <input type="text" id="edit_consultantName">
                    </div>
                    <div class="form-group">
                        <label>ä¼šç¤¾å</label>
                        <input type="text" id="edit_companyName">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h2>è»¢è·ç†ç”±ãƒ»èƒŒæ™¯</h2>
                <div id="whyNow_list" class="list-input"></div>
                <button class="add-btn" onclick="addListItem('whyNow')">+ é …ç›®ã‚’è¿½åŠ </button>
            </div>
            
            <div class="form-section">
                <h2>å¼·ã¿</h2>
                <div id="strengths_list" class="list-input"></div>
                <button class="add-btn" onclick="addListItem('strengths')">+ é …ç›®ã‚’è¿½åŠ </button>
            </div>
            
            <div class="form-section">
                <h2>ã‚­ãƒ£ãƒªã‚¢è»¸</h2>
                <div id="careerAxis_list" class="list-input"></div>
                <button class="add-btn" onclick="addListItem('careerAxis')">+ é …ç›®ã‚’è¿½åŠ </button>
            </div>
            
            <div class="form-section">
                <h2>ç¾è·ã®æ¥­å‹™</h2>
                <h3>æ¥­å‹™å†…å®¹</h3>
                <div id="workDesc_list" class="list-input"></div>
                <button class="add-btn" onclick="addListItem('workDesc')">+ é …ç›®ã‚’è¿½åŠ </button>
                
                <h3 style="margin-top: 15px;">æˆæœãƒ»å®Ÿç¸¾</h3>
                <div id="workAchieve_list" class="list-input"></div>
                <button class="add-btn" onclick="addListItem('workAchieve')">+ é …ç›®ã‚’è¿½åŠ </button>
            </div>
            
            <div class="form-section">
                <h2>åƒãæ–¹ã®å¸Œæœ›</h2>
                <div class="form-group">
                    <label>ãƒªãƒ¢ãƒ¼ãƒˆæ¯”ç‡</label>
                    <input type="text" id="edit_workStyle_remote">
                </div>
                <div class="form-group">
                    <label>ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ</label>
                    <input type="text" id="edit_workStyle_management">
                </div>
                <div class="form-group">
                    <label>ãƒãƒ¼ãƒ æ–‡åŒ–</label>
                    <input type="text" id="edit_workStyle_team">
                </div>
            </div>
            
            <div class="form-section">
                <h2>å°†æ¥ã®ãƒ“ã‚¸ãƒ§ãƒ³</h2>
                <div class="form-group">
                    <label>1å¹´å¾Œ</label>
                    <input type="text" id="edit_vision_oneYear">
                </div>
                <div class="form-group">
                    <label>3å¹´å¾Œ</label>
                    <input type="text" id="edit_vision_threeYears">
                </div>
                <div class="form-group">
                    <label>5å¹´å¾Œï¼ˆå¹´åï¼‰</label>
                    <input type="text" id="edit_vision_fiveYears_salary">
                </div>
            </div>
            
            <div class="form-section">
                <h2>èª²é¡Œãƒ»è‹¦æ‰‹ãªã“ã¨</h2>
                <div id="challenges_list" class="list-input"></div>
                <button class="add-btn" onclick="addListItem('challenges')">+ é …ç›®ã‚’è¿½åŠ </button>
            </div>
            
            <div class="form-section">
                <h2>ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—</h2>
                <p style="font-size: 11px; color: #718096; margin-bottom: 10px;">ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ç·¨é›†å¯</p>
                <input type="text" id="edit_behaviorTraits" placeholder="ä¾‹: èãä¸Šæ‰‹, ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é‡è¦–, ã‚³ãƒ„ã‚³ãƒ„å‹">
            </div>
            
            <div class="form-section">
                <h2>ã‚­ãƒ£ãƒªã‚¢æ–¹å‘æ€§ã®ææ¡ˆ</h2>
                <p style="font-size: 11px; color: #718096; margin-bottom: 10px;">AIãŒææ¡ˆã™ã‚‹ã‚­ãƒ£ãƒªã‚¢ã®é¸æŠè‚¢</p>
                <div id="careerDirections_list"></div>
                <button class="add-btn" onclick="addCareerDirection()">+ æ–¹å‘æ€§ã‚’è¿½åŠ </button>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="generatePreview()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ â†’</button>
                <button class="btn-secondary" onclick="goToStep(1)">â† æˆ»ã‚‹</button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»PDFä¿å­˜ -->
        <div class="step" id="step3">
            <div class="tip">
                <strong>ğŸ“¥ PDFã®ä¿å­˜æ–¹æ³•ï¼š</strong> 
                ã€ŒPDFã¨ã—ã¦ä¿å­˜ã€â†’ å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€Œé€ä¿¡å…ˆ: PDFã«ä¿å­˜ã€â†’ã€Œä¿å­˜ã€
            </div>
            
            <div class="button-group" style="margin-bottom: 15px;">
                <button class="btn-success" onclick="openPrintWindow()">ğŸ“¥ PDFã¨ã—ã¦ä¿å­˜</button>
                <button class="btn-secondary" onclick="goToStep(2)">â† ç·¨é›†ã«æˆ»ã‚‹</button>
                <button class="btn-secondary" onclick="resetAll()">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
            </div>
            
            <div class="preview-container">
                <iframe id="previewFrame" class="preview-frame"></iframe>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <span id="loadingText">å‡¦ç†ä¸­...</span>
        </div>
        
        <div class="message error" id="error"></div>
        <div class="message success" id="success"></div>
    </div>

    <script>
        let currentData = null;
        let reportHTML = '';
        let appConfig = { consultantName: 'çŸ³äº• è²´å¤§', companyName: 'å¥³æ€§æ´»èºã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼' };

        // åˆæœŸåŒ–: è¨­å®šã‚’èª­ã¿è¾¼ã‚€
        (function() {
            google.script.run
                .withSuccessHandler(function(config) {
                    if (config) {
                        appConfig = config;
                        console.log('è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', appConfig);
                    }
                })
                .withFailureHandler(function(err) {
                    console.warn('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                })
                .getClientConfig();
        })();

        // APIã‚­ãƒ¼ç¢ºèª
        function checkApiKey() {
            const statusEl = document.getElementById('apiStatus');
            statusEl.textContent = 'ç¢ºèªä¸­...';
            statusEl.style.color = '#718096';
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        statusEl.textContent = 'âœ… ' + result.message;
                        statusEl.style.color = '#38a169';
                    } else {
                        statusEl.textContent = 'âŒ ' + result.message;
                        statusEl.style.color = '#c53030';
                    }
                })
                .withFailureHandler(function(err) {
                    statusEl.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + err.message;
                    statusEl.style.color = '#c53030';
                })
                .checkGeminiApiKey();
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadSample() {
            document.getElementById('transcript').value = `# ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ãƒ’ã‚¢ãƒªãƒ³ã‚° æ–‡å­—èµ·ã“ã—ãƒ‡ãƒ¼ã‚¿

**æ—¥æ™‚ï¼š** 2025å¹´1æœˆ15æ—¥ï¼ˆæ°´ï¼‰14:00-15:30  
**å‚åŠ è€…ï¼š** çŸ³äº• è²´å¤§ï¼ˆã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ï¼‰ã€ç”°ä¸­ èŠ±å­ï¼ˆå€™è£œè€…ï¼‰

## ã€è»¢è·ç†ç”±ãƒ»èƒŒæ™¯ï¼ˆWhy Nowï¼‰ã€‘

**ç”°ä¸­ï¼š** ä»Šã®ä¼šç¤¾ã¯å¤§æ‰‹å•†ç¤¾ã§å–¶æ¥­ã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ãŒã€æ±ºã¾ã£ãŸãƒ—ãƒ­ã‚»ã‚¹ã«æ²¿ã£ã¦å‹•ãã“ã¨ãŒå¤šãã€è‡ªåˆ†ã§æ–°ã—ã„ã“ã¨ã‚’ææ¡ˆã™ã‚‹æ©Ÿä¼šãŒã‚ã‚Šã¾ã›ã‚“ã€‚

**ç”°ä¸­ï¼š** å¹´åŠŸåºåˆ—ãŒå¼·ãã€æˆæœã‚’å‡ºã—ã¦ã‚‚è©•ä¾¡ã«åæ˜ ã•ã‚Œã«ãã„ã§ã™ã€‚

**ç”°ä¸­ï¼š** åŒä¸–ä»£ã®å‹äººãŒè»¢è·ã—ã¦æ´»èºã—ã¦ã„ã‚‹ã®ã‚’è¦‹ã¦ã€è‡ªåˆ†ã‚‚å‹•ããŸã„ã¨æ€ã„ã¾ã—ãŸã€‚

## ã€ç¾è·ã®æ¥­å‹™ãƒ»æˆæœã€‘

**ç”°ä¸­ï¼š** è£½é€ æ¥­ã®ãŠå®¢æ§˜ã‚’æ‹…å½“ã—ã€ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³å…¨ä½“ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚å–å¼•å…ˆ20ç¤¾ã€å¹´é–“å£²ä¸Šç´„3å„„å††ã‚’æ‹…å½“ã€‚

**ç”°ä¸­ï¼š** 3å¹´å‰ã«æ–°è¦é–‹æ‹“ã§å¹´é–“5000ä¸‡å††ã®å–å¼•ã‚’ç«‹ã¡ä¸Šã’ã¾ã—ãŸã€‚

**ç”°ä¸­ï¼š** å»å¹´ã€æ—¢å­˜é¡§å®¢ã®å–å¼•é‡ã‚’30%å¢—åŠ ã•ã›ã¾ã—ãŸã€‚

## ã€å¼·ã¿ãƒ»è¡Œå‹•ç‰¹æ€§ã€‘

**ç”°ä¸­ï¼š** ãŠå®¢æ§˜ã®è©±ã‚’ã˜ã£ãã‚Šèã„ã¦èª²é¡Œã‚’è¦‹ã¤ã‘å‡ºã™ã“ã¨ãŒå¾—æ„ã§ã™ã€‚

**ç”°ä¸­ï¼š** äººã¨ã®é–¢ä¿‚æ§‹ç¯‰ãŒå¾—æ„ã§ã€åˆå¯¾é¢ã§ã‚‚ã™ãæ‰“ã¡è§£ã‘ã‚‰ã‚Œã¾ã™ã€‚

**ç”°ä¸­ï¼š** è¤‡æ•°æ¡ˆä»¶ã‚’åŒæ™‚ã«ç®¡ç†ã§ãã¾ã™ã€‚

## ã€ã‚­ãƒ£ãƒªã‚¢è»¸ãƒ»ä¾¡å€¤è¦³ã€‘

**ç”°ä¸­ï¼š** æˆé•·ã§ãã‚‹ç’°å¢ƒã§ã‚ã‚‹ã“ã¨ã€‚

**ç”°ä¸­ï¼š** ãƒãƒ¼ãƒ ã¨ä¿¡é ¼é–¢ä¿‚ã‚’ç¯‰ã‘ã‚‹ã“ã¨ã€‚

**ç”°ä¸­ï¼š** è‡ªåˆ†ã®ææ¡ˆãŒå½¢ã«ãªã‚‹ã“ã¨ã€‚

## ã€åƒãæ–¹ãƒ»ç’°å¢ƒã®å¸Œæœ›ã€‘

**ç”°ä¸­ï¼š** é€±2ã€œ3æ—¥å‡ºç¤¾ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å¸Œæœ›ã§ã™ã€‚

**ç”°ä¸­ï¼š** æ”¯æ´å‹ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒç†æƒ³ã§ã™ã€‚

## ã€å°†æ¥ã®ãƒ“ã‚¸ãƒ§ãƒ³ã€‘

**ç”°ä¸­ï¼š** 1å¹´å¾Œã¯æ–°ç’°å¢ƒã§æˆæœã‚’å‡ºã—ãŸã„ã€‚

**ç”°ä¸­ï¼š** 3å¹´å¾Œã¯å–¶æ¥­ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã—ã¦ãƒãƒ¼ãƒ ã‚’ç‡ã„ãŸã„ã€‚

**ç”°ä¸­ï¼š** 5å¹´å¾Œã¯å¹´å800ä¸‡å††ä»¥ä¸Šã§äº‹æ¥­è²¬ä»»è€…ã«ãªã‚ŠãŸã„ã€‚

## ã€èª²é¡Œãƒ»è‹¦æ‰‹é ˜åŸŸã€‘

**ç”°ä¸­ï¼š** äººå‰ã§è©±ã™ã“ã¨ãŒè‹¦æ‰‹ã§ç·Šå¼µã—ã¾ã™ã€‚

**ç”°ä¸­ï¼š** æ•°å­—ç®¡ç†ã‚„ãƒ‡ãƒ¼ã‚¿åˆ†æãŒã‚ã¾ã‚Šå¾—æ„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`;
            showMsg('success', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
        }

        // ãƒ‡ãƒ¼ã‚¿è§£æ
        function analyzeData() {
            const text = document.getElementById('transcript').value;
            if (!text.trim()) {
                showMsg('error', 'æ–‡å­—èµ·ã“ã—ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const useGemini = document.getElementById('useGemini').checked;
            showLoading(useGemini ? 'ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ã‚’æ•´ç†ä¸­...ï¼ˆ30ç§’ã»ã©ï¼‰' : 'ãƒ‡ãƒ¼ã‚¿ã‚’è§£æä¸­...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        currentData = result.data;
                        populateEditForm(currentData);
                        goToStep(2);
                        showMsg('success', 'ãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã¾ã—ãŸã€‚å†…å®¹ã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¦ãã ã•ã„ã€‚');
                    } else {
                        showMsg('error', 'ã‚¨ãƒ©ãƒ¼: ' + result.error);
                    }
                })
                .withFailureHandler(function(err) {
                    hideLoading();
                    showMsg('error', 'ã‚¨ãƒ©ãƒ¼: ' + err.message);
                })
                .analyzeTranscript(text, useGemini);
        }

        // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
        function populateEditForm(data) {
            // åŸºæœ¬æƒ…å ±
            document.getElementById('edit_candidateName').value = data.candidateName || '';
            document.getElementById('edit_date').value = data.date || '';
            document.getElementById('edit_consultantName').value = data.consultantName || appConfig.consultantName || '';
            document.getElementById('edit_companyName').value = data.companyName || appConfig.companyName || '';
            
            populateList('whyNow', data.whyNow || []);
            populateList('strengths', data.strengths || []);
            populateList('careerAxis', data.careerAxis || []);
            populateList('workDesc', data.currentWork?.description || []);
            populateList('workAchieve', data.currentWork?.achievements || []);
            
            // èª²é¡Œï¼ˆæ–°å½¢å¼: {issue, action}ï¼‰
            populateChallenges(data.challenges || []);
            
            document.getElementById('edit_workStyle_remote').value = data.workStyle?.remote || '';
            document.getElementById('edit_workStyle_management').value = data.workStyle?.management || '';
            document.getElementById('edit_workStyle_team').value = data.workStyle?.team || '';
            
            document.getElementById('edit_vision_oneYear').value = data.vision?.oneYear || '';
            document.getElementById('edit_vision_threeYears').value = data.vision?.threeYears || '';
            document.getElementById('edit_vision_fiveYears_salary').value = data.vision?.fiveYears?.salary || '';
            
            // è¡Œå‹•ç‰¹æ€§ï¼ˆé…åˆ—â†’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šæ–‡å­—åˆ—ï¼‰
            document.getElementById('edit_behaviorTraits').value = (data.behaviorTraits || []).join(', ');
            
            // ã‚­ãƒ£ãƒªã‚¢æ–¹å‘æ€§
            populateCareerDirections(data.careerDirections || []);
        }
        
        // èª²é¡Œãƒªã‚¹ãƒˆã‚’åæ˜ ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«èª²é¡Œã®ã¿ï¼‰
        function populateChallenges(challenges) {
            const container = document.getElementById('challenges_list');
            container.innerHTML = '';
            if (challenges.length === 0) {
                addListItem('challenges');
            } else {
                challenges.forEach(function(item) {
                    const text = typeof item === 'string' ? item : (item.issue || '');
                    addListItem('challenges', text);
                });
            }
        }
        
        // ã‚­ãƒ£ãƒªã‚¢æ–¹å‘æ€§ãƒªã‚¹ãƒˆã‚’åæ˜ 
        function populateCareerDirections(directions) {
            const container = document.getElementById('careerDirections_list');
            container.innerHTML = '';
            if (directions.length === 0) {
                addCareerDirection();
            } else {
                directions.forEach(function(item) {
                    addCareerDirection(item.title || '', item.description || '');
                });
            }
        }
        
        // ã‚­ãƒ£ãƒªã‚¢æ–¹å‘æ€§ã‚’è¿½åŠ 
        function addCareerDirection(title, description) {
            const container = document.getElementById('careerDirections_list');
            const index = container.children.length;
            const labels = ['A', 'B', 'C', 'D', 'E'];
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.padding = '10px';
            div.style.background = '#f8fafc';
            div.style.borderRadius = '4px';
            div.style.border = '1px solid #e2e8f0';
            div.innerHTML = `
                <div style="display:flex; align-items:center; margin-bottom:5px;">
                    <label style="width:80px; font-size:11px; font-weight:bold;">${labels[index] || ''}. ã‚¿ã‚¤ãƒˆãƒ«:</label>
                    <input type="text" class="direction-title" value="${title || ''}" style="flex:1;" placeholder="ä¾‹: æˆé•·ä¼æ¥­ã®å–¶æ¥­ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼">
                    <button class="remove-btn" onclick="this.parentElement.parentElement.remove()" style="margin-left:5px;">Ã—</button>
                </div>
                <div style="display:flex; align-items:center;">
                    <label style="width:80px; font-size:11px;">èª¬æ˜:</label>
                    <input type="text" class="direction-desc" value="${description || ''}" style="flex:1;" placeholder="ä¾‹: ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã§0â†’1çµŒé¨“ã‚’ç©ã‚€">
                </div>
            `;
            container.appendChild(div);
        }

        // ãƒªã‚¹ãƒˆé …ç›®ã‚’åæ˜ 
        function populateList(id, items) {
            const container = document.getElementById(id + '_list');
            container.innerHTML = '';
            if (items.length === 0) {
                addListItem(id);
            } else {
                items.forEach(function(item) {
                    addListItem(id, item);
                });
            }
        }

        // ãƒªã‚¹ãƒˆé …ç›®ã‚’è¿½åŠ 
        function addListItem(id, value) {
            const container = document.getElementById(id + '_list');
            const div = document.createElement('div');
            div.style.display = 'flex';
            div.style.alignItems = 'center';
            div.style.marginBottom = '5px';
            div.innerHTML = `
                <input type="text" class="list-item-${id}" value="${value || ''}" style="flex:1;">
                <button class="remove-btn" onclick="this.parentElement.remove()">Ã—</button>
            `;
            container.appendChild(div);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
        function collectFormData() {
            const getListValues = function(id) {
                const inputs = document.querySelectorAll('.list-item-' + id);
                const values = [];
                inputs.forEach(function(input) {
                    if (input.value.trim()) values.push(input.value.trim());
                });
                return values;
            };
            
            // èª²é¡Œã‚’åé›†ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«issueã®ã¿ï¼‰
            const getChallenges = function() {
                const inputs = document.querySelectorAll('.list-item-challenges');
                const challenges = [];
                inputs.forEach(function(input) {
                    if (input.value.trim()) {
                        challenges.push({ issue: input.value.trim() });
                    }
                });
                return challenges;
            };
            
            // ã‚­ãƒ£ãƒªã‚¢æ–¹å‘æ€§ã‚’åé›†
            const getCareerDirections = function() {
                const titles = document.querySelectorAll('.direction-title');
                const descs = document.querySelectorAll('.direction-desc');
                const directions = [];
                titles.forEach(function(input, i) {
                    if (input.value.trim()) {
                        directions.push({
                            title: input.value.trim(),
                            description: descs[i] ? descs[i].value.trim() : ''
                        });
                    }
                });
                return directions;
            };
            
            // è¡Œå‹•ç‰¹æ€§ã‚’åé›†ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šâ†’é…åˆ—ï¼‰
            const getBehaviorTraits = function() {
                const value = document.getElementById('edit_behaviorTraits').value;
                return value.split(/[,ã€ï¼Œ]/).map(t => t.trim()).filter(t => t.length > 0);
            };
            
            return {
                candidateName: document.getElementById('edit_candidateName').value,
                date: document.getElementById('edit_date').value,
                consultantName: document.getElementById('edit_consultantName').value || appConfig.consultantName,
                companyName: document.getElementById('edit_companyName').value || appConfig.companyName,
                whyNow: getListValues('whyNow'),
                strengths: getListValues('strengths'),
                careerAxis: getListValues('careerAxis'),
                currentWork: {
                    description: getListValues('workDesc'),
                    achievements: getListValues('workAchieve')
                },
                workStyle: {
                    remote: document.getElementById('edit_workStyle_remote').value,
                    management: document.getElementById('edit_workStyle_management').value,
                    team: document.getElementById('edit_workStyle_team').value
                },
                vision: {
                    oneYear: document.getElementById('edit_vision_oneYear').value,
                    threeYears: document.getElementById('edit_vision_threeYears').value,
                    fiveYears: {
                        salary: document.getElementById('edit_vision_fiveYears_salary').value
                    }
                },
                challenges: getChallenges(),
                behaviorTraits: getBehaviorTraits(),
                careerDirections: getCareerDirections()
            };
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ
        function generatePreview() {
            const data = collectFormData();
            showLoading('ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    hideLoading();
                    if (result.success) {
                        reportHTML = result.html;
                        const frame = document.getElementById('previewFrame');
                        const doc = frame.contentDocument || frame.contentWindow.document;
                        doc.open();
                        doc.write(result.html);
                        doc.close();
                        goToStep(3);
                        showMsg('success', 'ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼');
                    } else {
                        showMsg('error', 'ã‚¨ãƒ©ãƒ¼: ' + result.error);
                    }
                })
                .withFailureHandler(function(err) {
                    hideLoading();
                    showMsg('error', 'ã‚¨ãƒ©ãƒ¼: ' + err.message);
                })
                .generateReportFromData(data);
        }

        // PDFä¿å­˜ï¼ˆå°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰
        function openPrintWindow() {
            if (!reportHTML) {
                showMsg('error', 'ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            // reportHTMLã¯å®Œå…¨ãªHTMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆã‚¹ã‚¿ã‚¤ãƒ«å«ã‚€ï¼‰ãªã®ã§ã€
            // </body>ã®å‰ã«å°åˆ·ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æŒ¿å…¥ã™ã‚‹
            const printHTML = reportHTML.replace('</body>', 
                `<script>window.onload=function(){setTimeout(function(){window.print();},300);};<\/script></body>`
            );
            
            const w = window.open('', '_blank', 'width=900,height=700');
            if (w) {
                w.document.write(printHTML);
                w.document.close();
            } else {
                showMsg('error', 'ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚è¨±å¯ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // ã‚¹ãƒ†ãƒƒãƒ—ç§»å‹•
        function goToStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
            
            document.querySelectorAll('.step-badge').forEach((b, i) => {
                b.classList.remove('active', 'done');
                if (i + 1 < n) b.classList.add('done');
                if (i + 1 === n) b.classList.add('active');
            });
            hideMsg();
        }

        // ãƒªã‚»ãƒƒãƒˆ
        function resetAll() {
            document.getElementById('transcript').value = '';
            currentData = null;
            reportHTML = '';
            goToStep(1);
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loading').classList.add('active');
        }
        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }
        function showMsg(type, msg) {
            hideMsg();
            const el = document.getElementById(type);
            el.textContent = msg;
            el.classList.add('active');
        }
        function hideMsg() {
            document.getElementById('error').classList.remove('active');
            document.getElementById('success').classList.remove('active');
        }
    </script>
</body>
</html>
